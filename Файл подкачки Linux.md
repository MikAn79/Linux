
# Файл подкачки Linux

Опубликовано: 6 ноября, 2019 от [bazilius](https://losst.pro/author/bazilius "Просмотр всех записей bazilius") , 25 комменариев, время чтения: 9 минут

Сегодня мы будем говорить о файле подкачки в Linux. Расскажем для чего он нужен, как создать, изменить размер или удалить. В общем, все, что вам может понадобиться при работе со swap.

В операционной системе Linux, как и в других ОС, файл подкачки нужен для страховки оперативной памяти. Когда установленный объем ОЗУ заканчивается, используется именно выделенная область из файла подкачки. Это может понадобиться в двух случаях:

- Для того чтобы при полной занятости и, как следствие, отсутствия свободной оперативной памяти, компьютер не тормозил.
- Для распределения приоритетов (важным процессам отдается физическая оперативная память, а второстепенным файл подкачки Linux).

Сам по себе swap - это отдельный логический раздел вашего диска либо просто файл на системном разделе. Чаще всего он создается именно при установке операционной системы. Но создать swap linux можно и после завершения инсталляции ОС.

*В последних версиях операционной системы Ubuntu** Linux** файл подкачки создается автоматически вне зависимости от того, хотите вы этого или нет. При этом его размер составляет около 1 Гб.*


## Как посмотреть swap в Linux

Прежде чем приступить к процессу добавления, настройки или удаление файла подкачки, необходимо проверить его наличие. Для этого проще всего использовать приведенную ниже команду. В нашем случае она выглядит так:

`free -h`

[![](https://losst.pro/wp-content/uploads/2019/10/image2-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image2-1.jpg)

Используемая команда отображает размер файла подкачки вашей операционной системы. Однако, по ее результатам мы не можем определить – это файл подкачки или раздел подкачки. Поэтому будем использовать дополнительный другую команду, чтобы посмотреть swap linux. Вводим в терминал следующее:

`swapon --show`

[![](https://losst.pro/wp-content/uploads/2019/10/image3-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image3-1.jpg)

Как видите, в нашем случае под swap выделено 1.4 Гб и это файл. То есть, он находится не на отдельном разделе, а на том же диске, на котором установлена операционная система.

*Если это будет отдельный логический том, то под надписью «**TYPE**» мы увидим слово «partition».*

Если бы файл подкачки в вашей операционной системе отсутствовал, результат работы команды **free -h **выглядел бы примерно так:

[![](https://losst.pro/wp-content/uploads/2019/10/image4-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image4-1.jpg)

То есть, вместо каких-либо данных о файле подкачки вы увидите нули.

## Создание файла подкачки Linux

Если вы удостоверились в том, что файл подкачки отсутствует, можно переходить к его созданию. Пример, приведенный ниже, будет показан с использованием операционной системы Ubuntu 18.04, но работать это должно и на других дистрибутивах Linux.

### Шаг 1: Создаем swap файл

Давайте создадим файл подкачки для нашей Ubuntu. Для примера его размер составит 1 Гб. Запустите терминал и введите команду, приведенную ниже:

`sudo fallocate -l 1G /swapfile`

Для обеспечения безопасности файла обязательно устанавливаем на него нужные права.

`sudo chmod 600 /swapfile`

*При этом вместо «swapfile» мы можем указать любое другое название.*

[![](https://losst.pro/wp-content/uploads/2019/10/image5-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image5-1.jpg)

### Шаг 2: Создание файловой системы

Создание swap linux ещё не завершено. Теперь необходимо указать нашей операционной системе, что созданный объект должен использоваться как файл подкачки. Для этого мы будем использовать команду, приведенную ниже:

`sudo mkswap /swapfile`

Если все сделано верно, результат будет выглядеть так:

[![](https://losst.pro/wp-content/uploads/2019/10/image6-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image6-1.jpg)

### Шаг 3: Активируем файл подкачки

Хорошо, теперь наш Linux понимает, что это файл подкачки, но этого недостаточно. Нам также необходимо включить SWAP:

`sudo swapon /swapfile`

[![](https://losst.pro/wp-content/uploads/2019/10/image7-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image7-1.jpg)

Давайте проверим, все ли мы сделали правильно:

`swapon --show`

[![](https://losst.pro/wp-content/uploads/2019/10/image8-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image8.jpg)

Отлично, операционная система распознала наш файл подкачки и начала его использовать. Мы видим тип в поле **TYPE** и размер в поле **SIZE**.

### Шаг 4\. Сохранение изменений после перезагрузки

Все операции, которые мы предприняли выше, временны. Как только компьютер будет перезагружен, они отменятся. Для того чтобы сделать изменения постоянными, нам необходимо дописать кое-какую информацию в **/etc/fstab**. Для этого поступаем так:

Прежде чем начать работать с файлом, о котором мы говорим, необходимо обязательно создать его резервную копию:

`sudo cp /etc/fstab /etc/fstab.back`

[![](https://losst.pro/wp-content/uploads/2019/10/image9-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image9-1.jpg)

После этого можно переходить непосредственно к добавлению нужных нам данных. Нам надо добавить в файл такую строчку:

`/swapfile none swap sw 0 0`

Это реализуется через текстовый редактор, запущенный с правами суперпользователя, либо при помощи введенной в терминал команды:

`echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab`

[![](https://losst.pro/wp-content/uploads/2019/10/image10-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image10-1.jpg)

Готово. Изменения сохранены и файл подкачки не сбросится после перезагрузки операционной системы.

## Настройка swappiness

Дальше будет рассмотрена настройка swap linux. У файла подкачки существуют параметры, которые сообщают ОС, как часто его нужно использовать. Это явление называется «свопингом» и может иметь значение в пределах 0 - 100. Если это значение ближе к 100, ядро будет перемещать в раздел подкачки больше информации чтобы освободить память. При значениях ближе к нулю, система будет использовать подкачку только при крайней необходимости.

К примеру, в версии Ubuntu Linux для рабочего стола устанавливается параметр 60, а в серверных редакциях операционной системы - 1. Для того чтобы проверить, какой параметр используется в нашей ОС, вводим в терминал такую команду:

`cat /proc/sys/vm/swappiness`

[![](https://losst.pro/wp-content/uploads/2019/10/image11-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image11-1.jpg)

Как видите, в нашем случае «свопинг» установлен как 60\. Если же вы хотите поменять swappiness, можете воспользоваться оператором, цифра в конце которого и будет новым значением:

`sudo sysctl vm.swappiness=25`

[![](https://losst.pro/wp-content/uploads/2019/10/image12-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image12-1.jpg)

Как и в случае с конфигурацией файла подкачки, данный параметр изначально будет временным и обнулится при следующей перезагрузке. Для того чтобы сделать его постоянным, в самом конце файла **/etc/sysctl.conf** записываем значение **vm.swappiness=25**.

`vi /etc/sysctl.conf`

`vm.swappiness=25`

Для этого можно воспользоваться, например, текстовым редактором, запущенным с администраторскими полномочиями.

## Размер swap файла в Linux

Существует сразу несколько вариантов, позволяющих увеличить файл подкачки linux или уменьшить его. Однако, прежде чем их рассмотреть, необходимо напомнить об одном очень важном моменте:

*Когда вы полностью отключаете файл подкачки, ваша операционная система использует только ОЗУ и в случае ее нехватки это может привести к полной остановке работы компьютера. Система просто зависнет.*

Для того чтобы этого не произошло, в тот момент, когда мы удаляем или изменяем основной файл подкачки, необходимо создать второй, временный swap. Если вы это сделали или уверены в том, что имеющейся оперативной памяти хватит, можно переходить непосредственно к процессу изменения размера файла подкачки. Для этого давайте сначала отключим его:

`sudo swapoff /swapfile`

[![](https://losst.pro/wp-content/uploads/2019/10/image14-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image14-1.jpg)

Вторым этапом меняем размер файла подкачки, воспользовавшись командой, приведенной ниже. При этом размер вашего swap файла нужно указать вместо параметра **2G** (2 гигабайта):

`sudo fallocate -l 2G /swapfile`

Теперь форматируем полученный файл в файловую систему swap:

`sudo mkswap /swapfile`

А затем включаем его обратно:

`sudo swapon /swapfile`

[![](https://losst.pro/wp-content/uploads/2019/10/image15-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image15-1.jpg)

*При этом операционная система Linux позволяет использовать сразу несколько swap**.*

## Как удалить файл подкачки в Linux

Если по каким-то причинам файл подкачки вам не нужен, можете удалить его. Для этого сначала надо отключить swap linux:

`sudo swapoff /swapfile`

[![](https://losst.pro/wp-content/uploads/2019/10/image16-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image16-1.jpg)

А потом удаляем:

`sudo rm /swapfile`

[![](https://losst.pro/wp-content/uploads/2019/10/image17-1-922x576.jpg)](https://losst.pro/wp-content/uploads/2019/10/image17-1.jpg)

×

Не забудьте установить права на вновь созданный файл подкачки так, как мы описывали это выше.





    
