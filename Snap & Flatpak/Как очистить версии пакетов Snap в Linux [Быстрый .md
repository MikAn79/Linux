Это много, верно? Здесь вы можете освободить место на диске.

По замыслу Snap хранит по крайней мере одну старую версию пакетов, которые вы установили в своей системе.

Вы можете увидеть это поведение с помощью команды Snap:

```
snap list --all
```

Вы должны увидеть один и тот же пакет, указанный дважды с разными номерами версии и редакции.

<img width="730" height="317" src="../../_resources/snap-keeps-two-versions-of-each-_efa2718679394bed8.png" class="jop-noMdConv">

Snap хранит как минимум две версии каждого пакета

Чтобы освободить место на диске, вы можете удалить дополнительные версии пакетов. Как узнать, какой из них удалить? Вы можете видеть, что эти старые пакеты помечены как «отключенные».

Не волнуйтесь. Вам не нужно делать это вручную. Существует своего рода автоматический способ сделать это благодаря отличному сценарию bash, написанному Аланом Поупом, когда он работал в [Snapcraft](https://snapcraft.io/) команда.

я надеюсь ты знаешь [как создать и запустить скрипт оболочки bash](https://itsfoss.com/run-shell-script-linux/). По сути, создайте новый файл с именем clean-snap.sh и добавьте в него следующие строки.

```
#!/bin/bash
# Removes old revisions of snaps
# CLOSE ALL SNAPS BEFORE RUNNING THIS
set -eu
snap list --all | awk '/disabled/{print $1, $3}' |
    while read snapname revision; do
        snap remove "$snapname" --revision="$revision"
    done
```

Сохраните его и закройте редактор.

Чтобы запустить этот скрипт, сохраните его в своем домашнем каталоге, а затем [открыть терминал в Ubuntu](https://itsfoss.com/open-terminal-ubuntu/) и запустите эту команду:

```
sudo bash clean-snap.sh
```

Вы можете видеть, что он начинает удалять старые версии пакетов.

<img width="730" height="406" src="../../_resources/removing-old-snap-package-versio_f24878bbe86c401eb.png" class="jop-noMdConv">

Удаление старых версий snap-пакетов

Если вы сейчас проверите дисковое пространство, используемое Snap, вы увидите, что размер каталога теперь уменьшен.

```
[email protected]:~$ sudo du -sh /var/lib/snapd
3.9G	/var/lib/snapd
```

Если это работает для вас, вы можете время от времени запускать эту команду.

### Как работает этот скрипт?

Если вам интересно, что делает этот скрипт, позвольте мне объяснить.

Вы уже видели вывод команды «snap list –all». Его вывод передается в [команда awk](https://linuxhandbook.com/awk-command-tutorial/). Awk — мощный инструмент для написания сценариев.

Часть awk ‘/disabled/{print $1, $3}’ ищет строку ‘disabled’ в каждой строке и, если она найдена, извлекает первый столбец и третий столбец.

Этот вывод далее передается команде while и read. Команда чтения получает значение snapname первого столбца и переменной ревизии третьего столбца.

Затем эти переменные используются для запуска команды snap remove для удаления с именем пакета span и номером его версии.

Цикл while выполняется до тех пор, пока в нем найдены строки с отключенной строкой.

Все это легко понять, если вы немного разбираетесь в сценариях оболочки. Если вы не знакомы, у нас есть [серия руководств по bash для начинающих](https://linuxhandbook.com/tag/bash-beginner/) для вас.

## Вам вернули ГБ?

Вы можете увидеть на некоторых форумах, что рекомендуется установить значение сохранения пакета Snap равным 2.

```
sudo snap set system refresh.retain=2
```

Я не думаю, что это больше нужно. Поведение Snap по умолчанию теперь состоит в том, чтобы хранить всего 2 версии для любого пакета.